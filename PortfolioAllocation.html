<!DOCTYPE html>
<html lang="en"><head>
<script src="PortfolioAllocation_files/libs/clipboard/clipboard.min.js"></script>
<script src="PortfolioAllocation_files/libs/quarto-html/tabby.min.js"></script>
<script src="PortfolioAllocation_files/libs/quarto-html/popper.min.js"></script>
<script src="PortfolioAllocation_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="PortfolioAllocation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PortfolioAllocation_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="PortfolioAllocation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.280">

  <meta name="author" content="Prof.&nbsp;Carlos TrucÃ­os  ctrucios@unicamp.br">
  <title>Risk-based Portfolio Allocation Strategies</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="PortfolioAllocation_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="PortfolioAllocation_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #767676;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #767676;  padding-left: 4px; }
    div.sourceCode
      { color: #545454; background-color: #fefefe; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #545454; } /* Normal */
    code span.al { color: #7928a1; } /* Alert */
    code span.an { color: #696969; } /* Annotation */
    code span.at { color: #a55a00; } /* Attribute */
    code span.bn { color: #7928a1; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #d91e18; } /* ControlFlow */
    code span.ch { color: #008000; } /* Char */
    code span.cn { color: #d91e18; } /* Constant */
    code span.co { color: #696969; } /* Comment */
    code span.cv { color: #696969; font-style: italic; } /* CommentVar */
    code span.do { color: #696969; font-style: italic; } /* Documentation */
    code span.dt { color: #7928a1; } /* DataType */
    code span.dv { color: #7928a1; } /* DecVal */
    code span.er { color: #7928a1; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #a55a00; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #696969; } /* Information */
    code span.kw { color: #d91e18; } /* Keyword */
    code span.op { color: #00769e; } /* Operator */
    code span.ot { color: #d91e18; } /* Other */
    code span.pp { color: #7928a1; } /* Preprocessor */
    code span.sc { color: #00769e; } /* SpecialChar */
    code span.ss { color: #008000; } /* SpecialString */
    code span.st { color: #008000; } /* String */
    code span.va { color: #a55a00; } /* Variable */
    code span.vs { color: #008000; } /* VerbatimString */
    code span.wa { color: #696969; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="PortfolioAllocation_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="PortfolioAllocation_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="PortfolioAllocation_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="PortfolioAllocation_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="PortfolioAllocation_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="PortfolioAllocation_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="PortfolioAllocation_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="imagens/unicamp.png" data-background-opacity="1" data-background-position="99% 5%" data-background-size="20%" class="quarto-title-block center">
  <h1 class="title">Risk-based Portfolio Allocation Strategies</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Prof.&nbsp;Carlos TrucÃ­os <br> ctrucios@unicamp.br 
</div>
        <p class="quarto-title-affiliation">
            Instituto de MatemÃ¡tica, EstatÃ­stica e ComputaÃ§Ã£o CientÃ­fica (IMECC), <br> Universidade Estadual de Campinas (UNICAMP).
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Agenda</h2>
<ul>
<li class="fragment"><a href="#/introduÃ§Ã£o" id="/toc-introduÃ§Ã£o">IntroduÃ§Ã£o</a></li>
<li class="fragment"><a href="#/markowitz" id="/toc-markowitz">Markowitz</a></li>
<li class="fragment"><a href="#/hands-on-i" id="/toc-hands-on-i">Hands-On I</a></li>
<li class="fragment"><a href="#/outros-portfolios" id="/toc-outros-portfolios">Outros portfolios</a></li>
<li class="fragment"><a href="#/hands-on-ii" id="/toc-hands-on-ii">Hands-On II</a></li>
<li class="fragment"><a href="#/ml-risk-based-portfolios" id="/toc-ml-risk-based-portfolios">ML Risk-Based Portfolios</a></li>
<li class="fragment"><a href="#/avaliando-portfolios" id="/toc-avaliando-portfolios">Avaliando Portfolios</a></li>
<li class="fragment"><a href="#/aplicaÃ§Ã£o" id="/toc-aplicaÃ§Ã£o">AplicaÃ§Ã£o</a></li>
<li class="fragment"><a href="#/tÃ³picos-de-pesquisa" id="/toc-tÃ³picos-de-pesquisa">TÃ³picos de pesquisa</a></li>
</ul>
</nav>
</section>
<section>
<section id="introduÃ§Ã£o" class="title-slide slide level1 center">
<h1>IntroduÃ§Ã£o</h1>

</section>
<section id="introduÃ§Ã£o-1" class="slide level2">
<h2>IntroduÃ§Ã£o</h2>
<center>
<img data-src="imagens/eggs.png">
<center>
</center></center></section>
<section id="introduÃ§Ã£o-2" class="slide level2">
<h2>IntroduÃ§Ã£o</h2>
<ul>
<li class="fragment">Suponha que temos 2 ativos, <span class="math inline">\(A\)</span> e <span class="math inline">\(B\)</span>, nos quais estamos interessados em investir. Como alocaria seus recursos neste investimento?</li>
<li class="fragment">Suponha que temos 2 ativos, <span class="math inline">\(A\)</span> e <span class="math inline">\(B\)</span>, com retornos esperados de <span class="math inline">\(3\)</span> e <span class="math inline">\(5\)</span> e variÃ¢ncias iguais <span class="math inline">\(2\)</span> e <span class="math inline">\(4\)</span>, respectivamente. Como alocaria seus recursos de forma a maximizar seu retorno esperado e minimizar seu risco?</li>
<li class="fragment">Suponha que temos 2 ativos, <span class="math inline">\(A\)</span> e <span class="math inline">\(B\)</span>, com retornos esperados de <span class="math inline">\(3\)</span> e <span class="math inline">\(5\)</span> e variÃ¢ncias iguais <span class="math inline">\(2\)</span> e <span class="math inline">\(4\)</span>, respectivamente e correlaÃ§Ã£o igual a 0.5. Como alocaria seus recursos de forma a maximizar seu retorno esperado e minimizar seu risco?</li>
<li class="fragment">Seja <span class="math inline">\(\omega\)</span> e <span class="math inline">\(\mu\)</span> os vetores (coluna) de pesos e retornos esperados, respectivamente e seja <span class="math inline">\(\Sigma\)</span> a matriz de covariÃ¢ncia associada (risco). Queremos maximizar <span class="math display">\[\mu' \omega - \lambda \omega' \Sigma \omega,\]</span> em que <span class="math inline">\(\lambda\)</span> Ã© o parÃ¢metro de aversÃ£o ao risco (quanto maior, mais advessos ao risco somos)</li>
</ul>
</section></section>
<section>
<section id="markowitz" class="title-slide slide level1 center">
<h1>Markowitz</h1>

</section>
<section id="markowitz-1952" class="slide level2">
<h2>Markowitz (1952)</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>S <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb1-3"><a href="#cb1-3"></a>rp <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb1-4"><a href="#cb1-4"></a>risco <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb1-6"><a href="#cb1-6"></a>  aux <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>  omega <span class="ot">&lt;-</span> <span class="fu">c</span>(aux, <span class="dv">1</span> <span class="sc">-</span> aux)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  rp[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(omega <span class="sc">*</span> mu)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  risco[i] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(omega <span class="sc">%*%</span> S <span class="sc">%*%</span> omega)</span>
<span id="cb1-10"><a href="#cb1-10"></a>}</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">plot</span>(risco, rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="PortfolioAllocation_files/figure-revealjs/unnamed-chunk-1-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="markowitz-1952-1" class="slide level2">
<h2>Markowitz (1952)</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>S <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">1.4142</span>, <span class="fl">1.4142</span>, <span class="dv">4</span>), <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a>rp <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-4"><a href="#cb2-4"></a>risco <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb2-6"><a href="#cb2-6"></a>  aux <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>  omega <span class="ot">&lt;-</span> <span class="fu">c</span>(aux, <span class="dv">1</span> <span class="sc">-</span> aux)</span>
<span id="cb2-8"><a href="#cb2-8"></a>  rp[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(omega <span class="sc">*</span> mu)</span>
<span id="cb2-9"><a href="#cb2-9"></a>  risco[i] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(omega <span class="sc">%*%</span> S <span class="sc">%*%</span> omega)</span>
<span id="cb2-10"><a href="#cb2-10"></a>}</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="fu">plot</span>(risco, rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="PortfolioAllocation_files/figure-revealjs/unnamed-chunk-2-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="markowitz-1" class="slide level2">
<h2>Markowitz</h2>
<p>Quando <span class="math inline">\(\lambda\)</span> Ã© grande, o problema a ser resolvido, torna-se, aproximadamente, minimizar <span class="math display">\[\omega' \Sigma \omega,\]</span></p>
<center>
<span style="color:red;">Carteira conhecida como <strong>carteira de variÃ¢ncia mÃ­nima</strong>.</span>
</center>
<div class="fragment">
<ul>
<li class="fragment">Vamos assumir que todo nosso capital serÃ¡ alocado, ou seja <span class="math inline">\(\displaystyle \sum_{i = 1}^N\omega_i = 1\)</span></li>
<li class="fragment">EntÃ£o, queremos minimizar com restriÃ§Ã£o</li>
</ul>
</div>
</section>
<section id="markowitz-2" class="slide level2">
<h2>Markowitz</h2>
<p>Seja um portfolio com <span class="math inline">\(N\)</span> ativos e matriz de covariÃ¢ncia <span class="math inline">\(\Sigma\)</span>. Queremos minimizar <span class="math display">\[L(\boldsymbol{\omega}, \lambda) = \boldsymbol{\omega}' \Sigma \boldsymbol{\omega} + \lambda (\boldsymbol{1}'\boldsymbol{\omega} - 1),\]</span> em que <span class="math inline">\(\boldsymbol{1} = [1, 1, \cdots, 1]'.\)</span></p>
<div class="fragment">
<p><a href="https://ctruciosm.github.io/slides/Aula_02.pdf">Derivando</a> <em>w.r.t.</em> <span class="math inline">\(\boldsymbol{\omega}\)</span> e <span class="math inline">\(\lambda\)</span></p>
<ul>
<li class="fragment"><span class="math inline">\(\dfrac{\partial L}{\partial \boldsymbol{\omega}} = 2 \Sigma \boldsymbol{\omega} + \lambda \boldsymbol{1}\)</span></li>
<li class="fragment"><span class="math inline">\(\dfrac{\partial L}{\partial \lambda} = \boldsymbol{1}' \boldsymbol{\omega} - 1\)</span></li>
</ul>
</div>
<div class="fragment">
<p>Igualando a zero, <span class="math display">\[\Sigma \boldsymbol{\omega} = - \dfrac{\lambda \boldsymbol{1}}{2} \rightarrow \boldsymbol{\omega} = \dfrac{-\lambda}{2} \Sigma^{-1} \boldsymbol{1}\]</span></p>
</div>
</section>
<section id="markowitz-3" class="slide level2">
<h2>Markowitz</h2>
<p><span class="math display">\[1 = \boldsymbol{1}' \boldsymbol{\omega} =   \dfrac{-\lambda}{2} \boldsymbol{1}' \Sigma^{-1} \boldsymbol{1} \rightarrow \lambda = \dfrac{-2}{\boldsymbol{1}' \Sigma^{-1} \boldsymbol{1}}.\]</span></p>
<p>Assim,</p>
<p><span class="math display">\[\boldsymbol{\omega} = \dfrac{\Sigma^{-1} \boldsymbol{1}}{\boldsymbol{1}' \Sigma^{-1} \boldsymbol{1}},\]</span> sÃ£o os pesos Ã³timos da carteira de variÃ¢ncia mÃ­nima.</p>
<div class="fragment">
<p>Na prÃ¡tica, <span class="math inline">\(\Sigma\)</span> nÃ£o Ã© conhecido, devendo ser estimado com os dados (<span class="math inline">\(\hat{\Sigma}\)</span>).</p>
</div>
</section></section>
<section>
<section id="hands-on-i" class="title-slide slide level1 center">
<h1>Hands-On I</h1>

</section>
<section id="hands-on-i-1" class="slide level2">
<h2>Hands-On I</h2>
<p>Utilizando retornos mensais das aÃ§Ãµes na B3, calcularemos os pesos para a carteira de variÃ¢ncia mÃ­nima. Utilizaremos os pacotes do R <code>yfR</code>, <code>RiskPortfolios</code>, <code>tidyr</code> e <code>dplyr</code>.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">#library(yfR)</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#library(dplyr)</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#library(tidyr)</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Lista de aÃ§Ãµes que fazem parte do Ã­ndice Ibovespa</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#acoes &lt;- yf_index_composition("IBOV")</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#acoes$ticker</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hands-on-i-2" class="slide level2">
<h2>Hands-On I</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Formato Yahoo Finance</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#ibov_tickers &lt;- paste0(acoes$ticker, ".SA")</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># Baixando PreÃ§os</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#precos &lt;- yf_get(tickers = ibov_tickers, </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#                 first_date = "2015-01-01",</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#                 last_date  = "2024-04-30", </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#                 freq_data = "monthly")</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#glimpse(precos)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hands-on" class="slide level2">
<h2>Hands-On</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(HierPortfolios)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># Estimamos a matriz de covariÃ¢ncia</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#Sigma &lt;- precos |&gt; </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#  select(ref_date, ticker, ret_adjusted_prices) |&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#  pivot_wider(id_cols = ref_date, values_from = ret_adjusted_prices, names_from = ticker) |&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#  drop_na() |&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#  select(-ref_date) |&gt; </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#  cov()</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(mldp_returns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hands-on-1" class="slide level2">
<h2>Hands-On</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(Sigma)</span>
<span id="cb6-2"><a href="#cb6-2"></a>ones <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> n)</span>
<span id="cb6-3"><a href="#cb6-3"></a>w <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="fu">t</span>(ones) <span class="sc">%*%</span> <span class="fu">solve</span>(Sigma) <span class="sc">%*%</span> ones)) <span class="sc">*</span> <span class="fu">solve</span>(Sigma) <span class="sc">%*%</span> ones</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="fu">round</span>(w, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]
ASSET1   0.1450
ASSET2   0.2530
ASSET3   0.2270
ASSET4   0.1988
ASSET5   0.1868
ASSET6  -0.0297
ASSET7   0.0578
ASSET8   0.0150
ASSET9  -0.0505
ASSET10 -0.0033</code></pre>
</div>
</div>
</section>
<section id="hands-on-2" class="slide level2">
<h2>Hands-On</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Calculamos os pesos Ã³timos</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(RiskPortfolios)</span>
<span id="cb8-3"><a href="#cb8-3"></a>omega <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"minvol"</span>))</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">cbind</span>(w, omega)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          omega
ASSET1   0.14497249  0.14497249
ASSET2   0.25304038  0.25304038
ASSET3   0.22699176  0.22699176
ASSET4   0.19881419  0.19881419
ASSET5   0.18675677  0.18675677
ASSET6  -0.02965077 -0.02965077
ASSET7   0.05782148  0.05782148
ASSET8   0.01501568  0.01501568
ASSET9  -0.05046142 -0.05046142
ASSET10 -0.00330055 -0.00330055</code></pre>
</div>
</div>
</section>
<section id="hands-on-i-3" class="slide level2">
<h2>Hands-On I</h2>
<ul>
<li class="fragment">Na prÃ¡tica, <span class="math inline">\(\Sigma\)</span> nÃ£o Ã© conhecido, devendo ser estimado com os dados (<span class="math inline">\(\hat{\Sigma}\)</span>).</li>
<li class="fragment">Utilizar <span class="math inline">\(\hat{\Sigma}\)</span> em lugar de <span class="math inline">\(\Sigma\)</span> implica em erro de estimaÃ§Ã£o.</li>
<li class="fragment">Isto faz com que os pesos estejam alocados em poucos ativos, existe pouca diversificaÃ§Ã£o e o desempenhho fora da amostra seja pobre ð</li>
<li class="fragment">Para lidar com este problema, diversas abordagens tem sido propostas.</li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>ObservaÃ§Ãµes:</strong></p>
</div>
<div class="callout-content">
<ul>
<li class="fragment">Na prÃ¡tica Ã© muito dificil estimar <span class="math inline">\(\mu\)</span>. Ã por isso que carteiras baseadas em rico (<span class="math inline">\(\Sigma\)</span>) sÃ£o preferidas.</li>
<li class="fragment">Ã comÃºm impor a restriÃ§Ã£o de que <span class="math inline">\(\omega_i \geq 0\)</span> (<em>no-short-selling constraints</em> ou restriÃ§Ã£o de nÃ£o venda a descoberto).</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="hands-on-i-4" class="slide level2">
<h2>Hands-On I</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>omega <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"minvol"</span>, <span class="at">constraint =</span> <span class="st">"lo"</span>))</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">round</span>(omega, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.1444 0.1993 0.1973 0.1987 0.1868 0.0000 0.0586 0.0149 0.0000 0.0000</code></pre>
</div>
</div>
</section></section>
<section>
<section id="outros-portfolios" class="title-slide slide level1 center">
<h1>Outros portfolios</h1>

</section>
<section id="outros-portfolios-1" class="slide level2">
<h2>Outros portfolios</h2>
<h3 id="pesos-iguais">Pesos iguais</h3>
<ul>
<li class="fragment">TambÃ©m chamada de estratÃ©gia ingÃªnua ou <span class="math inline">\(1/N\)</span>.</li>
<li class="fragment">Ã a estratÃ©gia mais simples e nÃ£o precisa cÃ¡lculos difÃ­ceis nem resolver problemas de otimizaÃ§Ã£o.</li>
<li class="fragment">Para um conjunto de <span class="math inline">\(N\)</span> ativos financeiros, os pesos sÃ£o obtidos como <span class="math display">\[\omega_i = 1/N, \quad \forall i= 1, \cdots, N.\]</span></li>
<li class="fragment">Apesar da sua simplicidade, diversos autores mencionam que o desempenho fora da amostra desta estratÃ©gia Ã© dificilmente superado por mÃ©todos mais complexos <a href="https://doi.org/10.1093/acprof:oso/9780199744282.003.0034">DeMiguel et al.&nbsp;2009</a></li>
</ul>
</section>
<section id="outros-portfolios-2" class="slide level2">
<h2>Outros portfolios</h2>
<h3 id="volatilidade-inversa">Volatilidade inversa</h3>
<p>Proposto por <a href="https://www.pm-research.com/content/iijpormgmt/38/3/56">Leote De Carvalho et al.&nbsp;(2012)</a>, esta estratÃ©gia nÃ£o leva em consideraÃ§Ã£o covariÃ¢ncias, mas apenas variÃ¢ncias. Os pesos sÃ£o obtidos como:</p>
<p><span class="math display">\[\boldsymbol{\omega} = \Big( \dfrac{1/\sigma_1}{ \displaystyle \sum_{j = 1}^N 1/\sigma_j}, \cdots, \dfrac{1/\sigma_N}{ \displaystyle \sum_{j = 1}^N 1/\sigma_j} \Big)'\]</span></p>
<div class="fragment">
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<center>
<code>optimalPortfolio(Sigma, control = list(type = 'invvol', constraint = 'lo'))</code>
</center>
</div>
</div>
</div>
</div>
</section>
<section id="outros-portfolios-3" class="slide level2">
<h2>Outros portfolios</h2>
<h3 id="diversificaÃ§Ã£o-mÃ¡xima">DiversificaÃ§Ã£o mÃ¡xima</h3>
<p>Proposto por <a href="https://doi.org/10.3905/JPM.2008.35.1.40">Choueifaty and Coignard (2008)</a>, o objetivo Ã© maximizar a razÃ£o <span class="math display">\[DR = \dfrac{\boldsymbol{\omega}'\boldsymbol{\sigma}}{\sqrt{\boldsymbol{\omega}' \Sigma \boldsymbol{\omega}}},\]</span> sujeito Ã¡ restriÃ§Ã£o de que <span class="math inline">\(\boldsymbol{1}' \boldsymbol{\omega} = 1\)</span> e <span class="math inline">\(\omega_i \geq 0\)</span> e em que <span class="math inline">\(\boldsymbol{\sigma} = \sqrt{diag(\Sigma)}\)</span>.</p>
<div class="fragment">
<p>Note que no caso extremos de que a carteira esteja formada po apenas um ativo, <span class="math inline">\(DR = 1\)</span>, implicando uma carteira pobremente diversificada.</p>
</div>
<div class="fragment">
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<center>
<code>optimalPortfolio(Sigma, control = list(type = 'maxdiv', constraint = 'lo'))</code>
</center>
</div>
</div>
</div>
</div>
</section>
<section id="outros-portfolios-4" class="slide level2">
<h2>Outros portfolios</h2>
<h3 id="igual-contribuiÃ§Ã£o-ao-risco">Igual contribuiÃ§Ã£o ao risco</h3>
<p>Popularizada por <a href="http://www.panagora.com/assets/PanAgora-Risk-Parity-Portfolios-Efficient-Portfolios-Through-True-Diversification.pdf">Qian (2005)</a>, a ideia desta estratÃ©gia Ã© que cada um dos ativos tenha a mesma contribuiÃ§Ã£o marginal ao risco (volatilidade) da carteira, ou seja, que a proporÃ§Ã£o da contribuiÃ§Ã£o ao risco de cada ativo deve ser <span class="math inline">\(1/N\)</span>. Ativos com pouco risco receberÃ£o pessos maiores e ativos com muito risco receberÃ£o pesos menores.</p>
<div class="fragment">
<p>Os pesos sÃ£o obtidos minimizando <span class="math display">\[\displaystyle \sum_{i = 1}^N (\%RC_i - 1/N)^2,\]</span> sujeito Ã¡ restriÃ§Ã£o de que <span class="math inline">\(\boldsymbol{1}' \boldsymbol{\omega} = 1\)</span>, em que <span class="math inline">\(\%RC_i = \omega_i [\Sigma \boldsymbol{\omega}]_i / \boldsymbol{\omega}' \Sigma \boldsymbol{\omega}\)</span> Ã© a porcentagem de risco com que o ativo <span class="math inline">\(i\)</span> contribui para o risco total.</p>
</div>
<div class="fragment">
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<center>
<code>optimalPortfolio(Sigma, control = list(type = 'erc', constraint = 'lo'))</code>
</center>
</div>
</div>
</div>
</div>
</section>
<section id="outros-portfolios-5" class="slide level2">
<h2>Outros portfolios</h2>
<h3 id="mÃ¡xima-decorrelation">MÃ¡xima decorrelation</h3>
<p>Proposto por <a href="https://academic.oup.com/rfs/article-abstract/25/12/3711/1594463?login=false">Christoffersen et al.&nbsp;(2012)</a>, esta estratÃ©gia pode ser vista como um caso particular do portfolio de variÃ¢ncia mÃ­nima mas com <span class="math inline">\(\rho\)</span> (matriz de correlaÃ§Ã£o) em lugar de <span class="math inline">\(\Sigma\)</span> (matriz de covariÃ¢ncia). Assim, queremos minimizar <span class="math display">\[\boldsymbol{\omega} \rho \boldsymbol{\omega},\]</span> sujeito Ã¡ restriÃ§Ã£o de que <span class="math inline">\(\boldsymbol{1}' \boldsymbol{\omega} = 1\)</span></p>
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<center>
<code>optimalPortfolio(Sigma, control = list(type = 'maxdec', constraint = 'lo'))</code>
</center>
</div>
</div>
</div>
</section></section>
<section>
<section id="hands-on-ii" class="title-slide slide level1 center">
<h1>Hands-On II</h1>

</section>
<section id="hands-on-ii-1" class="slide level2">
<h2>Hands-On II</h2>
<p>Utilizando os dados anteriores, calcularemos os pesos Ã³timos utiliando as estratÃ©gias vistas anteriormente.</p>
<div class="fragment">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>omega_invol <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'invvol'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb12-2"><a href="#cb12-2"></a>omega_erc <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'erc'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb12-3"><a href="#cb12-3"></a>omega_maxdiv <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'maxdiv'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb12-4"><a href="#cb12-4"></a>omega_maxdec <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'maxdec'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section></section>
<section>
<section id="ml-risk-based-portfolios" class="title-slide slide level1 center">
<h1>ML Risk-Based Portfolios</h1>

</section>
<section id="ml-risk-based-portfolios-1" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<ul>
<li class="fragment">Recentemente, novas estratÃ©gias de alocaÃ§Ã£o de carteiras baseadas em <em>machine learning</em> tem surgido na literatura.</li>
<li class="fragment">Algumas destas estratÃ©gias utilizam algoritmos de clusterizaÃ§Ã£o hierÃ¡rquica (HRP, HCAA, HERC, DHRP).</li>
<li class="fragment">Estas estratÃ©gias surgem para superar algumas das limitaÃ§Ãµes da estratÃ©gia de Markowitz, bem como incluir a ideia de que âsistemas complexos, como o mercado financeiro, estÃ£o organizados de forma hierÃ¡rquicaâ</li>
</ul>
</section>
<section id="ml-risk-based-portfolios-2" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp">Hierarchical Risk Parity (HRP)</h3>
<ul>
<li class="fragment">Proposta por <a href="https://www.pm-research.com/content/iijpormgmt/42/4/59">Lopez de Prado (2016)</a></li>
<li class="fragment">Surge como uma alternativa para evitar os problemas observados da optimizaÃ§Ã£o de Markowitz.</li>
<li class="fragment">A ideia bÃ¡sica do algoritmo Ã© transformar a matriz de covariÃ¢ncia em matriz de distÃ¢ncias, aplicar um mÃ©todo de agrupamento hierÃ¡rquico, fazer bissecÃ§Ãµes e calcular os pesos atravÃ©s da estratÃ©gia de volatilidade inversa.</li>
</ul>
</section>
<section id="ml-risk-based-portfolios-3" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp-1">Hierarchical Risk Parity (HRP)</h3>
<ul>
<li class="fragment">A matriz de distÃ¢ncia utilizada no mÃ©todo de agrupamento hierÃ¡rquico Ã© denotada por <span class="math inline">\(\tilde{D}\)</span> cujos elementos <span class="math inline">\({\tilde{d}_{ij}}\)</span> sÃ£o obtidos como <span class="math display">\[\tilde{d}_{ij} = \sqrt{\displaystyle \sum_{k = 1}^N (d_{ki} - d_{kj})^2},\]</span> em que <span class="math inline">\(N\)</span> Ã© o nÃºmero de ativos e <span class="math inline">\(d_{ij} = \sqrt{0.5 \times (1 - \rho_{ij})}\)</span> com <span class="math inline">\(\rho_{ij}\)</span> sendo a correlaÃ§Ãµ entre os ativos <span class="math inline">\(i\)</span> e <span class="math inline">\(j\)</span>.</li>
</ul>
</section>
<section id="ml-risk-based-portfolios-4" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp-2">Hierarchical Risk Parity (HRP)</h3>

<img data-src="PortfolioAllocation_files/figure-revealjs/unnamed-chunk-10-1.png" width="960" class="r-stretch quarto-figure-center"></section>
<section id="ml-risk-based-portfolios-5" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp-3">Hierarchical Risk Parity (HRP)</h3>
<ul>
<li class="fragment">Dentro de cada grupo, o vetor de pesos prÃ©vios do grupo <span class="math inline">\(k\)</span> (<span class="math inline">\(k = 1, 2\)</span>) Ã© obtido atravÃ©s do mÃ©todo de volatilidade inversa, <span class="math display">\[\boldsymbol{\omega}_p^{(k)} = \dfrac{1}{Trace(Diag(\Sigma^{(k)})^{-1})} \times Diag(\Sigma^{(k)})^{-1},\]</span> em que <span class="math inline">\(\Sigma^{(k)}\)</span> Ã© a matriz de covariÃ¢ncia dos ativos no grupo <span class="math inline">\(k\)</span>.</li>
<li class="fragment">Com os pesos obtidos, calculamos a variÃ¢ncia de cada grupo como <span class="math inline">\(V^{(k)} = \boldsymbol{\omega}_p^{(k)} \Sigma^{(k)}\boldsymbol{\omega}_p^{(k) \prime},\)</span> e, finalmente <span class="math inline">\(\alpha = 1 - \frac{V^{(1)}}{V^{(1)} + V^{(2)}}\)</span> que Ã© um fator de ponderaÃ§Ã£o que atualizarÃ¡ o peso de cada ativo.</li>
<li class="fragment">Os pesos finais sÃ£o atualizados para <span class="math inline">\(\boldsymbol{\omega}^{(1)} = \alpha \boldsymbol{\omega}^{(1)}\)</span> e <span class="math inline">\(\boldsymbol{\omega}^{(2)} = (1 - \alpha) \boldsymbol{\omega}^{(2)}\)</span>.</li>
<li class="fragment">O processo se repete atÃ© que cada grupo tenha apenas um ativo.</li>
</ul>
</section>
<section id="ml-risk-based-portfolios-6" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp-4">Hierarchical Risk Parity (HRP)</h3>
<center>
<img data-src="imagens/hrp_step_by_step.png">
</center>

<aside><div>
No comeÃ§o, cada ativo tem peso igual a 1.
</div></aside></section>
<section id="ml-risk-based-portfolios-7" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp-5">Hierarchical Risk Parity (HRP)</h3>
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">library</span>(HierPortfolios)</span>
<span id="cb13-2"><a href="#cb13-2"></a>omega_hrp <span class="ot">&lt;-</span> <span class="fu">HRP_Portfolio</span>(Sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="ml-risk-based-portfolios-8" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-risk-parity-hrp-6">Hierarchical Risk Parity (HRP)</h3>
<ul>
<li class="fragment">Uma das crÃ­ticas do HRP Ã© que ele nÃ£o utiliza a clusterizaÃ§Ã£o mas apenas a ordem.</li>
<li class="fragment">Algumas modificaÃ§Ãµes do algoritmo surguiram na literatura:
<ul>
<li class="fragment">Hierarchical Clustering-Based Asset Allocation (HCAA) <a href="https://www.pm-research.com/content/iijpormgmt/44/2/89">(Raffinot, 2017)</a></li>
<li class="fragment">Hierarchical Equal Risk Contribution (HERC) <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3237540">(Raffinot, 2018)</a></li>
<li class="fragment">A Constrained Hierarchical Risk Parity Algorithm with Cluster-based Capital Allocation (DHRP) <a href="https://www.fmx.nfkatzke.com/Projects/HRP.pdf">(Pfitzingera and Katzke, 2019)</a></li>
</ul></li>
</ul>
</section>
<section id="ml-risk-based-portfolios-9" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="a-constrained-hierarchical-risk-parity-algorithm-with-cluster-based-capital-allocation-dhrp">A Constrained Hierarchical Risk Parity Algorithm with Cluster-based Capital Allocation (DHRP)</h3>
<ul>
<li class="fragment">Visando incorporar uma maior parte da informaÃ§Ã£o extraida a partir da clusterizaÃ§Ã£o, bem como incluir algumas prÃ¡ticas usuais do mercado financeiro, Pfitzinger et al.(2019) propÃµe trÃªs modificaÃ§Ãµes Ã  proposta de Lopez de Prado (2016).</li>
<li class="fragment">A primeira modificaÃ§Ã£o consiste em utilizar um algoritmo divisivo em vez de algoritmo aglomerativo como sugerido por Lopez de Prado (2016).</li>
<li class="fragment">Permite a inclusÃ£o de restriÃ§Ãµes nos pesos e,</li>
<li class="fragment">AtravÃ©s de um parÃ¢metro <span class="math inline">\(\tau\)</span>, Ã© possÃ­vel aproveitar toda a estrutura hierarquica obtida na clusterizaÃ§Ã£o (<span class="math inline">\(\tau = 1\)</span>), parte dela (<span class="math inline">\(\tau \in (0, 1)\)</span>) ou apenas a ordenaÃ§Ã£o (<span class="math inline">\(\tau = 0\)</span>).</li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>omega_dhrp <span class="ot">&lt;-</span> <span class="fu">DHRP_Portfolio</span>(Sigma, <span class="at">tau =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="ml-risk-based-portfolios-10" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-clustering-based-asset-allocation-hcaa">Hierarchical Clustering-Based Asset Allocation (HCAA)</h3>
<ul>
<li class="fragment">HRP e DHRP nÃ£o levam em consideraÃ§Ã£o o nÃºmero de clusters a serem formados.</li>
<li class="fragment">HCAA leva isto em consideraÃ§Ã£o e, apÃ³s selecionar o nÃºmero de grupos a serem formados, os pesos sÃ£o calculados entre os grupos e dentro dos grupos.</li>
<li class="fragment">A ideia Ã© distribuir o capital total a ser investido de forma igual entre os clusters hierarquicamente (assim ativos correlacionados que formarÃ£o um cluster recebem o mesmo peso total do que um ativo nÃ£o correlacionado, obtendo diversificaÃ§Ã£o).</li>
<li class="fragment">Dentro de cada cluster, os pesos sÃ£o calculados atravÃ©s da estratÃ©gia de pesos iguais.</li>
</ul>
</section>
<section id="ml-risk-based-portfolios-11" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-clustering-based-asset-allocation-hcaa-1">Hierarchical Clustering-Based Asset Allocation (HCAA)</h3>
<center>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="imagens/hacc.png"></p>
<p></p><figcaption>Exemplo: 3 clusters</figcaption><p></p>
</figure>
</div>
</center>
</section>
<section id="ml-risk-based-portfolios-12" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-clustering-based-asset-allocation-hcaa-2">Hierarchical Clustering-Based Asset Allocation (HCAA)</h3>
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>omega_hacc <span class="ot">&lt;-</span> <span class="fu">HCAA_Portfolio</span>(Sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of clusters: 5"</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="ml-risk-based-portfolios-13" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-equal-risk-contribution-herc">Hierarchical Equal Risk Contribution (HERC)</h3>
<ul>
<li class="fragment">HRP faz as bissecÃ§Ãµes considerando apenas a ordem do dendrograma e nÃ£o o dendrograma <em>per se</em>.</li>
<li class="fragment">Parecido com HACC mas em lugar de calcular os pesos de forma que o total a ser investido seja dividio de forma igual entre cluster, calcula os pesos de forma que a contribuiÃ§Ã£o ao risco seja a mesma dentro de cada cluter.</li>
<li class="fragment">Dentro de cada cluster, utiliza-se o mÃ©todo de volatilidade inversa.</li>
</ul>
</section>
<section id="ml-risk-based-portfolios-14" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<h3 id="hierarchical-equal-risk-contribution-herc-1">Hierarchical Equal Risk Contribution (HERC)</h3>
<div class="callout callout-note callout-captioned callout-style-default">
<div class="callout-body">
<div class="callout-caption">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>No R</strong></p>
</div>
<div class="callout-content">
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>omega_herc <span class="ot">&lt;-</span> <span class="fu">HERC_Portfolio</span>(Sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="ml-risk-based-portfolios-15" class="slide level2">
<h2>ML Risk-Based Portfolios</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(omega, omega_invol, omega_maxdec, omega_maxdiv, omega_erc, omega_hrp, omega_dhrp, omega_hacc, omega_herc), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        omega omega_invol omega_maxdec omega_maxdiv omega_erc weights weights
ASSET1  0.144       0.102        0.049        0.050     0.103   0.070   0.109
ASSET2  0.199       0.101        0.037        0.037     0.084   0.076   0.053
ASSET3  0.197       0.102        0.120        0.122     0.102   0.108   0.104
ASSET4  0.199       0.101        0.197        0.199     0.144   0.190   0.194
ASSET5  0.187       0.102        0.077        0.078     0.103   0.097   0.099
ASSET6  0.000       0.099        0.075        0.074     0.098   0.102   0.098
ASSET7  0.059       0.099        0.155        0.153     0.102   0.066   0.103
ASSET8  0.015       0.098        0.125        0.123     0.100   0.091   0.093
ASSET9  0.000       0.098        0.053        0.052     0.081   0.071   0.098
ASSET10 0.000       0.098        0.112        0.110     0.082   0.128   0.049
        weights weights
ASSET1    0.125   0.078
ASSET2    0.167   0.278
ASSET3    0.062   0.017
ASSET4    0.062   0.008
ASSET5    0.031   0.004
ASSET6    0.062   0.016
ASSET7    0.125   0.074
ASSET8    0.031   0.004
ASSET9    0.167   0.261
ASSET10   0.167   0.260</code></pre>
</div>
</div>
</section></section>
<section>
<section id="avaliando-portfolios" class="title-slide slide level1 center">
<h1>Avaliando Portfolios</h1>

</section>
<section id="medidas-de-desempenho" class="slide level2">
<h2>Medidas de desempenho</h2>
<p>Seja <span class="math inline">\(p\)</span> o tamanho do perÃ­odo fora da amostra</p>
<ul>
<li class="fragment">Average (AV): <span class="math display">\[AV = 12\frac{\sum_{i = 1}^{p}R_{i}}{p},\]</span> em que <span class="math inline">\(R_{i}\)</span> sÃ£o os retornos fora da amostra. AV calcula a mÃ©dia anualizado o qual Ã© multiplicado por 12. <strong>Quanto maior, melhor o desempenho da carteira</strong>.</li>
<li class="fragment">Standard Deviation (SD): <span class="math display">\[SD = \sqrt{12}\hat{\sigma}_{p},\]</span> em que <span class="math inline">\(\hat{\sigma}_{p}\)</span> Ã© o desvio-padrÃ£o anualizado dos retornos fora da amostra. <strong>Quanto menor, menor o risco e tem um desempenho melhor da carteira</strong>.</li>
</ul>
</section>
<section id="medidas-de-desempenho-1" class="slide level2">
<h2>Medidas de desempenho</h2>
<ul>
<li class="fragment">Sharpe Ratio (SR): <span class="math display">\[SR = \frac{\bar{R}_{p} - \bar{R}_{f}}{\bar{\sigma}_{p-f}},\]</span> em que <span class="math inline">\(R_{f}\)</span> Ã© a taxa livre de risco, <span class="math inline">\(\bar{R}_{p}\)</span> Ã© a mÃ©dia dos retornos fora da amostra e <span class="math inline">\(\bar{\sigma}_{p-f}\)</span> Ã© desvio-padrÃ£o estimado do excesso de retorno. <strong>Quanto maior, melhor o desempenho da carteira</strong>.</li>
<li class="fragment">Adjusted Sharpe Ratio (ASR): <span class="math display">\[SR = SR(1 + (\frac{\mu_{3}}{6})SR - (\frac{\mu_{4}-3}{24})SR^2),\]</span> em que <span class="math inline">\(\mu_{3}\)</span> Ã© a assimetria, <span class="math inline">\(\mu_{4}\)</span> Ã© a cÃºrtose e <span class="math inline">\(SR\)</span> Ã© o Sharpe Ratio acima apresentado. EstÃ¡ mÃ©trica ajusta o Sharpe ratio incluindo o terceiro e segundo momento amostral. Quanto maior este valor, melhor o desempenho da carteira.</li>
</ul>
</section>
<section id="medidas-de-desempenho-2" class="slide level2">
<h2>Medidas de desempenho</h2>
<ul>
<li class="fragment">Sortino ratio (SO): <span class="math display">\[SO = \frac{\bar{R}_{p}}{\sqrt{\frac{\sum_{i=1}^{K}min(0,R_{p,i} - MAR)^2}{K}}},\]</span> em que <span class="math inline">\(K\)</span> Ã© o tamanho do periodo fora da amostra e MAR Ã© retorno mÃ­nimo aceitado, os quais Ã© igual a taxa livre de risco mensal. Quanto maior, melhor o desempenho de portfÃ³lio.</li>
</ul>
</section></section>
<section>
<section id="aplicaÃ§Ã£o" class="title-slide slide level1 center">
<h1>AplicaÃ§Ã£o</h1>

</section>
<section id="aplicaÃ§Ã£o-1" class="slide level2">
<h2>AplicaÃ§Ã£o</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">library</span>(yfR)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="fu">library</span>(RiskPortfolios)</span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="fu">library</span>(HierPortfolios)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a></span>
<span id="cb20-8"><a href="#cb20-8"></a>acoes <span class="ot">&lt;-</span> <span class="fu">yf_index_composition</span>(<span class="st">"IBOV"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Error in dplyr::rename(., ticker = Ticker, company = Company, industry = Industry) : 
  Can't rename columns that don't exist.
â Column `Ticker` doesn't exist.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>ibov_tickers <span class="ot">&lt;-</span> <span class="fu">paste0</span>(acoes<span class="sc">$</span>ticker, <span class="st">".SA"</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a>retornos <span class="ot">&lt;-</span> <span class="fu">yf_get</span>(<span class="at">tickers =</span> ibov_tickers, </span>
<span id="cb22-4"><a href="#cb22-4"></a>                 <span class="at">first_date =</span> <span class="st">"2010-01-01"</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>                 <span class="at">last_date  =</span> <span class="st">"2024-04-30"</span>, </span>
<span id="cb22-6"><a href="#cb22-6"></a>                 <span class="at">freq_data =</span> <span class="st">"monthly"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">select</span>(ref_date, ticker, ret_adjusted_prices) <span class="sc">|&gt;</span> </span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> ref_date, <span class="at">values_from =</span> ret_adjusted_prices, <span class="at">names_from =</span> ticker) <span class="sc">|&gt;</span> </span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb22-10"><a href="#cb22-10"></a>retornos[, <span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> retornos[, <span class="sc">-</span><span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="fu">glimpse</span>(retornos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 145
Columns: 65
$ ref_date  &lt;date&gt; 2012-04-02, 2012-05-02, 2012-06-01, 2012-07-02, 2012-08-01,â¦
$ ABEV3.SA  &lt;dbl&gt; 7.11413536, -7.15025981, 1.25515207, 1.80494846, -0.82426827â¦
$ ALPA4.SA  &lt;dbl&gt; 7.979696, -17.395711, 5.097994, -9.104450, 8.119689, 8.69564â¦
$ AMER3.SA  &lt;dbl&gt; -2.0482054, -25.4612648, -3.4653286, 14.1880255, 17.5149783,â¦
$ B3SA3.SA  &lt;dbl&gt; -4.6263416, -9.8466541, 7.3299018, 12.1951045, -6.0575006, 1â¦
$ BBAS3.SA  &lt;dbl&gt; -9.1329542, -14.6986401, 0.5778854, 11.6231165, 7.4748320, 9â¦
$ BBDC3.SA  &lt;dbl&gt; -5.1420701, -3.6453761, 0.9578953, 5.6352278, 3.4586713, -1.â¦
$ BBDC4.SA  &lt;dbl&gt; -3.8982821, -3.3071401, 1.8106114, 5.6063119, 4.0133681, -0.â¦
$ BEEF3.SA  &lt;dbl&gt; 22.2065210, -10.4166829, 9.5607273, 8.6084947, 15.3094436, 5â¦
$ BPAN4.SA  &lt;dbl&gt; -9.9560708, -24.3902619, 9.6774185, -22.5489996, 22.7848025,â¦
$ BRAP4.SA  &lt;dbl&gt; 4.0094222, -9.5702268, 4.3726281, -6.7091665, -14.3833348, 6â¦
$ BRFS3.SA  &lt;dbl&gt; -3.1944511, -9.9282588, -2.8186653, -3.4550857, 11.1452010, â¦
$ BRKM5.SA  &lt;dbl&gt; -3.1329491, -16.0447637, 18.9333408, -7.3991200, 3.3091122, â¦
$ CCRO3.SA  &lt;dbl&gt; 0.5159951, 6.0811188, 4.0127455, 4.7152461, 6.6666516, -2.35â¦
$ CIEL3.SA  &lt;dbl&gt; 10.9064437, -4.7203203, 8.4037202, 1.1171455, 0.8369454, -14â¦
$ CMIG4.SA  &lt;dbl&gt; 11.1228195, -6.8819115, 6.6341866, 4.3962323, -11.7662097, -â¦
$ COGN3.SA  &lt;dbl&gt; 0.0000000, 0.0000000, -32.3076666, -9.0909483, 10.0000475, 0â¦
$ CPFE3.SA  &lt;dbl&gt; 0.01621949, -7.39211097, 2.91732949, -6.92913910, -5.8695358â¦
$ CPLE6.SA  &lt;dbl&gt; 14.7739365, -15.0549051, 7.7523077, -4.7963754, -14.2109814,â¦
$ CSAN3.SA  &lt;dbl&gt; -2.5324028, -9.4864061, 3.4379358, 0.6776209, 10.8042579, 9.â¦
$ CSNA3.SA  &lt;dbl&gt; -0.2124926, -20.5504735, -12.3941358, -7.4692493, -5.6030416â¦
$ CYRE3.SA  &lt;dbl&gt; -2.8671599, -1.8181870, -2.1163920, 0.0000000, 11.5540712, 5â¦
$ DXCO3.SA  &lt;dbl&gt; -2.693329, -13.749987, 10.041382, 13.360953, 1.924681, 9.113â¦
$ ECOR3.SA  &lt;dbl&gt; -0.3135034, 1.5094415, 0.1858803, 2.5974036, 0.9644411, 5.37â¦
$ EGIE3.SA  &lt;dbl&gt; 1.6138686, 1.8264525, 11.0612832, -1.6150743, -4.8794115, -5â¦
$ ELET3.SA  &lt;dbl&gt; -4.9008248, -11.3167812, 7.3850822, -0.7017325, -7.9858801, â¦
$ ELET6.SA  &lt;dbl&gt; -3.3741192, -11.1205982, 4.3850266, 2.7151545, -7.9800385, -â¦
$ EMBR3.SA  &lt;dbl&gt; 12.2950681, -12.7128960, -6.3486897, -1.6466977, 6.5448739, â¦
$ ENEV3.SA  &lt;dbl&gt; 8.2206292, -14.6748028, -11.1111097, 7.4675349, 14.1993972, â¦
$ ENGI11.SA &lt;dbl&gt; -0.4651014, 0.0000000, 0.4672747, -4.6511306, 4.3128874, 6.2â¦
$ EQTL3.SA  &lt;dbl&gt; 2.7007223, 4.4776447, 2.0408146, 1.0666356, 2.5725743, 15.11â¦
$ EZTC3.SA  &lt;dbl&gt; -4.1085997, -4.9880987, 3.0999824, 5.6256296, 12.7180969, 2.â¦
$ FLRY3.SA  &lt;dbl&gt; 1.9086880, -1.7101273, 5.6338400, -16.0392302, 3.5926279, 9.â¦
$ GGBR4.SA  &lt;dbl&gt; 2.6346111, -11.1102207, 11.6015015, 5.1977169, -3.1043541, 7â¦
$ GOAU4.SA  &lt;dbl&gt; 3.37932033, -13.87172870, 10.97742202, 5.32975648, -4.602856â¦
$ GOLL4.SA  &lt;dbl&gt; -16.7350287, -20.7881773, 10.9452736, 7.0627803, 1.5706806, â¦
$ HYPE3.SA  &lt;dbl&gt; -4.8249135, -9.8119436, 7.6156145, 8.6773115, 1.9379751, 13.â¦
$ ITSA4.SA  &lt;dbl&gt; -11.2804287, -2.7593832, -3.3541852, 13.0588451, -2.7055377,â¦
$ ITUB4.SA  &lt;dbl&gt; -14.077008, -2.284538, -3.397625, 14.836448, -1.478275, -3.5â¦
$ JBSS3.SA  &lt;dbl&gt; 0.0000000, -27.3333373, 10.6422283, -11.1111238, 8.9552319, â¦
$ JHSF3.SA  &lt;dbl&gt; -0.1669249, 0.1672040, 0.1669483, 2.4999807, 28.1301341, -3.â¦
$ LREN3.SA  &lt;dbl&gt; 0.0976046, -5.0922224, -2.8252743, 8.7311602, 9.2215014, 1.6â¦
$ MGLU3.SA  &lt;dbl&gt; -4.8496105, -17.9069692, 0.7503221, 9.0425805, 10.2439095, 8â¦
$ MRFG3.SA  &lt;dbl&gt; -8.7826055, -13.2507245, 2.6373759, 1.1777235, 21.2698654, 2â¦
$ MRVE3.SA  &lt;dbl&gt; -14.3629580, -18.4640262, 7.3903250, 19.8924433, 4.3049353, â¦
$ MULT3.SA  &lt;dbl&gt; 5.50995227, 7.09808904, 2.63048315, 5.41088460, -0.01931626,â¦
$ PCAR3.SA  &lt;dbl&gt; 3.906735, 0.000000, 1.017362, 0.000000, 1.017360, 0.000000, â¦
$ PETR3.SA  &lt;dbl&gt; -7.8601041, -10.6916681, -4.5454089, 6.0846514, 6.2344094, 9â¦
$ PETR4.SA  &lt;dbl&gt; -8.8222574, -9.2159368, -4.6000972, 6.8492884, 6.4615546, 7.â¦
$ PRIO3.SA  &lt;dbl&gt; -13.326791, -38.412409, -7.259255, -20.447292, -6.626510, -4â¦
$ QUAL3.SA  &lt;dbl&gt; 6.0703086, 3.6144289, 2.0930279, 3.9294151, 9.3150543, -0.75â¦
$ RADL3.SA  &lt;dbl&gt; 15.7183459, -9.2015634, 8.8839129, 15.5555817, -7.6922905, 8â¦
$ RENT3.SA  &lt;dbl&gt; -3.1249770, -1.2873936, -5.1562768, 9.7708545, 7.9445826, -0â¦
$ SANB11.SA &lt;dbl&gt; -7.4999934, 4.8906032, -4.6829314, 0.7143531, -0.0645286, -3â¦
$ SBSP3.SA  &lt;dbl&gt; 7.4361172, -5.1175452, 8.4354059, 13.6104043, -1.5775086, -3â¦
$ SUZB3.SA  &lt;dbl&gt; 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.0000000, 0.000â¦
$ TAEE11.SA &lt;dbl&gt; 13.9087880, -16.0177191, 20.9091202, 6.7668883, 3.5211743, 0â¦
$ TIMS3.SA  &lt;dbl&gt; -1.8491084, -14.0211420, 14.4615073, -23.4767154, -6.4402652â¦
$ TOTS3.SA  &lt;dbl&gt; 10.2373794, -1.7496662, 6.0273812, -2.3255614, 4.3650942, 6.â¦
$ UGPA3.SA  &lt;dbl&gt; 8.2499962, -4.1801566, 8.9418976, 6.8584188, -8.5116745, 4.3â¦
$ USIM5.SA  &lt;dbl&gt; -9.075776, -22.161172, -25.647046, 16.772151, 10.433592, 24.â¦
$ VALE3.SA  &lt;dbl&gt; 1.7998549, -11.7605625, 6.7571292, -7.4258587, -9.0713513, 8â¦
$ VIVT3.SA  &lt;dbl&gt; -2.915147, -9.940559, 3.777888, -2.434216, -11.440768, 2.005â¦
$ WEGE3.SA  &lt;dbl&gt; 1.7171490, 3.2770824, -5.9780805, -4.4973523, 8.5898632, 17.â¦
$ YDUQ3.SA  &lt;dbl&gt; 22.01689354, 6.30252682, -3.95256162, 3.82716077, 24.8513499â¦</code></pre>
</div>
</div>
</section>
<section id="aplicaÃ§Ã£o-2" class="slide level2">
<h2>AplicaÃ§Ã£o</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(retornos)</span>
<span id="cb24-2"><a href="#cb24-2"></a>ins <span class="ot">&lt;-</span> <span class="dv">90</span>  </span>
<span id="cb24-3"><a href="#cb24-3"></a>oos <span class="ot">&lt;-</span> n_obs <span class="sc">-</span> ins</span>
<span id="cb24-4"><a href="#cb24-4"></a>Rp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol =</span> <span class="dv">10</span>, <span class="at">nrow =</span> oos)</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>oos) {</span>
<span id="cb24-7"><a href="#cb24-7"></a>  r <span class="ot">&lt;-</span> retornos[i<span class="sc">:</span>(i <span class="sc">+</span> ins  <span class="sc">-</span> <span class="dv">1</span>), <span class="sc">-</span><span class="dv">1</span>]  </span>
<span id="cb24-8"><a href="#cb24-8"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">cov</span>(r)</span>
<span id="cb24-9"><a href="#cb24-9"></a>  w_mv <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'minvol'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb24-10"><a href="#cb24-10"></a>  w_iv <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'invvol'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb24-11"><a href="#cb24-11"></a>  w_erc <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'erc'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb24-12"><a href="#cb24-12"></a>  w_md <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'maxdiv'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb24-13"><a href="#cb24-13"></a>  w_mdec <span class="ot">&lt;-</span> <span class="fu">optimalPortfolio</span>(Sigma, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">'maxdec'</span>, <span class="at">constraint =</span> <span class="st">'lo'</span>))</span>
<span id="cb24-14"><a href="#cb24-14"></a>  w_hrp <span class="ot">&lt;-</span> <span class="fu">HRP_Portfolio</span>(Sigma)<span class="sc">$</span>w</span>
<span id="cb24-15"><a href="#cb24-15"></a>  w_dhrp <span class="ot">&lt;-</span> <span class="fu">DHRP_Portfolio</span>(Sigma)<span class="sc">$</span>w</span>
<span id="cb24-16"><a href="#cb24-16"></a>  w_hcaa <span class="ot">&lt;-</span> <span class="fu">HCAA_Portfolio</span>(Sigma)<span class="sc">$</span>w</span>
<span id="cb24-17"><a href="#cb24-17"></a>  w_herc <span class="ot">&lt;-</span> <span class="fu">HERC_Portfolio</span>(Sigma)<span class="sc">$</span>w</span>
<span id="cb24-18"><a href="#cb24-18"></a>  Rp[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(<span class="fu">as.numeric</span>(retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>])),</span>
<span id="cb24-19"><a href="#cb24-19"></a>               <span class="fu">sum</span>(w_mv <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-20"><a href="#cb24-20"></a>               <span class="fu">sum</span>(w_iv <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-21"><a href="#cb24-21"></a>               <span class="fu">sum</span>(w_erc <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-22"><a href="#cb24-22"></a>               <span class="fu">sum</span>(w_md <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-23"><a href="#cb24-23"></a>               <span class="fu">sum</span>(w_mdec <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-24"><a href="#cb24-24"></a>               <span class="fu">sum</span>(w_hrp <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-25"><a href="#cb24-25"></a>               <span class="fu">sum</span>(w_dhrp <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-26"><a href="#cb24-26"></a>               <span class="fu">sum</span>(w_hcaa <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb24-27"><a href="#cb24-27"></a>               <span class="fu">sum</span>(w_herc <span class="sc">*</span> retornos[i <span class="sc">+</span> ins, <span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb24-28"><a href="#cb24-28"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 7"
[1] "Number of clusters: 7"
[1] "Number of clusters: 7"
[1] "Number of clusters: 6"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 7"
[1] "Number of clusters: 5"
[1] "Number of clusters: 6"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 6"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 6"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 5"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 5"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 5"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 2"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"
[1] "Number of clusters: 6"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">colnames</span>(Rp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"EW"</span>, <span class="st">"Min Var"</span>, <span class="st">"Inv Vol"</span>, <span class="st">"ERC"</span>, <span class="st">"Max Div"</span>, <span class="st">"Max Dec"</span>, <span class="st">"HRP"</span>, <span class="st">"DHRP"</span>, <span class="st">"HCAA"</span>, <span class="st">"HERC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="aplicaÃ§Ã£o-3" class="slide level2">
<h2>AplicaÃ§Ã£o</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>medidas <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="co"># Annualized Average</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  AV <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="co"># Annualized SD</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  SD <span class="ot">&lt;-</span> <span class="fu">sd</span>(x)</span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="co"># Information (or Sharpe) Ratio</span></span>
<span id="cb27-7"><a href="#cb27-7"></a>  SR <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)<span class="sc">/</span><span class="fu">sd</span>(x)</span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="co"># Adjusted Sharpe Ratio</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  ASR <span class="ot">&lt;-</span> SR<span class="sc">*</span>(<span class="dv">1</span> <span class="sc">+</span> (moments<span class="sc">::</span><span class="fu">skewness</span>(x)<span class="sc">/</span><span class="dv">6</span>)<span class="sc">*</span>SR <span class="sc">-</span> ((moments<span class="sc">::</span><span class="fu">kurtosis</span>(x) <span class="sc">-</span> <span class="dv">3</span>)<span class="sc">/</span><span class="dv">24</span>)<span class="sc">*</span>SR<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="co"># Sortino Ratio</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  SO <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">mean</span>(<span class="fu">ifelse</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, x<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb27-12"><a href="#cb27-12"></a>  output <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span><span class="sc">*</span>AV, <span class="fu">sqrt</span>(<span class="dv">12</span>)<span class="sc">*</span>SD, <span class="fu">sqrt</span>(<span class="dv">12</span>)<span class="sc">*</span>SR, <span class="fu">sqrt</span>(<span class="dv">12</span>)<span class="sc">*</span>ASR, <span class="fu">sqrt</span>(<span class="dv">12</span>)<span class="sc">*</span>SO)</span>
<span id="cb27-13"><a href="#cb27-13"></a>  <span class="fu">return</span>(output)</span>
<span id="cb27-14"><a href="#cb27-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="aplicaÃ§Ã£o-4" class="slide level2">
<h2>AplicaÃ§Ã£o</h2>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>oos_table <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(Rp, <span class="dv">2</span>, medidas))</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="fu">colnames</span>(oos_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AV"</span>,<span class="st">"SD"</span>, <span class="st">"SR"</span>, <span class="st">"ASR"</span>, <span class="st">"SO"</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a>oos_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              AV       SD        SR       ASR        SO
EW      10.60624 27.97355 0.3791523 0.3712893 0.5429380
Min Var 13.02561 21.38207 0.6091839 0.5938155 0.7919228
Inv Vol 10.09279 25.91329 0.3894833 0.3810191 0.5559619
ERC     11.09936 24.83001 0.4470140 0.4372605 0.6230263
Max Div 11.96937 25.70252 0.4656885 0.4564098 0.6272147
Max Dec 12.74200 29.91898 0.4258836 0.4237482 0.5557735
HRP     10.02127 23.06435 0.4344916 0.4232169 0.6167115
DHRP    11.03072 22.62630 0.4875175 0.4729434 0.6811797
HCAA    16.43590 28.13026 0.5842782 0.5649882 0.7923079
HERC    26.25454 50.14611 0.5235609 0.5114153 0.7039243</code></pre>
</div>
</div>
</section></section>
<section>
<section id="tÃ³picos-de-pesquisa" class="title-slide slide level1 center">
<h1>TÃ³picos de pesquisa</h1>

</section>
<section id="tÃ³picos-de-pesquisa-1" class="slide level2">
<h2>TÃ³picos de pesquisa</h2>

<img src="imagens/imecc.png" class="slide-logo r-stretch"><div class="footer footer-default">
<p>Carlos TrucÃ­os (IMECC/UNICAMP) | ENCPOS - Risk-Based Portfolio Allocation | <a href="https://ctruciosm.github.io/">ctruciosm.github.io</a></p>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="PortfolioAllocation_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="PortfolioAllocation_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="PortfolioAllocation_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'print',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>